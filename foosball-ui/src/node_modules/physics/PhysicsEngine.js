import { World, Vec3, Body, Plane, Sphere } from "cannon";

export default class {
  startPhysicsEngine() {
    let workerCode = "console.log('???')";
    let blob = new Blob([workerCode], { type: "text/javascript" });
    let dt = 1 / 60,
      N = 40;
    this.worker = new Worker(window.URL.createObjectURL(blob));
    this.worker.onmessage = function(event) {
      let delay = dt * 1000 - (Date.now() - this.sendTime);
      console.log('delay', delay);
      if (delay < 0) {
        delay = 0;
      }

      console.log(event.data);
      setTimeout(this.sendDataToWorker, delay);
    };

    this.sendDataToWorker();
  }

  stopPhysicsEngine() {
    this.worker.terminate();
    this.worker = undefined;
  }

  sendDataToWorker() {
    this.sendTime = Date.now();
    console.log("Update worker");
  }
}
